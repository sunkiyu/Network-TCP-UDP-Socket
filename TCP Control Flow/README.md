# TCP 오류 제어
- 데이터 전송 중 발생되는 에러는 검출 및 보정하는 메커니즘.
- 확인 응답(Acknowlegement)
  => 수신측에서 오는 확인 응답 종류(ACK,NACK)에 따라 대응 송출
  => 긍정 확인 응답(ACK), 부정 확인 응답(NACK)

- 재전송(Retransmission, ARQ)
  => 시간 만료시, 재전송 요구
  => 타이머 작동, 시간 만료이면 에러 발생으로 간주
  => 수신측이 오류 확인시, 재전송 요구
  => (기타) 빠른 재전송 : TCP 재전송에서 3개의 중복 ACK를 보내는 (빠른 재전송) 방식도 있음

# TCP 흐름 제어(Flow Control)
  - 송신측이 수신측의 처리속도 보다 더 빨리 데이터를 보내지 못하도록 제어.
  - 수신측에서 송신측 발송 데이터량이나 속도를 제한(송신측을 억제하는 형태)
  - 따라서 수신측에서 데이터가 넘침을 송식측에 통보하는 피드백 필요.
  - 이를 '속도 조절(pacing)' 이라고도 함 (즉, 송신, 수신의 속도를 일치시킴)
 
# 흐름제어 방식의 구분
* 송신제어 방식(정지대기 방식=Stop and Wait)) : 한번에 1개씩 수신확인하며 프레임을 전송하는 방식
* 전송률 기반 흐름제어
* 윈도우 기반 흐름 제어(Sliding window) : 여러 개의 프레임을 동시에 보내고자하는 기법

# 통신계층별 흐름제어 방식의 특징
* 데이터링크 계층에서, 흐름제어
  - 데이터 링크의 송수신 양단 간에 송신율 및 수신율의 균형을 맞춤

* 망 계층에서, 흐름제어
  - 통신망 종류에 따라, 흐름제어 기능 제공을 할 수도 안할 수도 있음

* IP계층에서 흐름제어 방식
  - IP계층에서는 명시적인 흐름제어 기능이 없음
  - 그 상위계층(즉, 전송계층)에서 흐름제어 기능을 제공함
  - IP계층에서는 송수신 버퍼 정도의 기능은 제공하게됨

***
## 정지대기 방식
* 검출후 재전송 방식(ARQ)의 일종, 정지대기(Stop and Wait)를 기본으로 함.
1. 송신측에서 1개의 프레임 송신
2. 수신측에서 수신된 프레임 에러 유무 판단, 송신측에 ACK나 NAK를 보냄
3. 송신측은 수신측으로 부터 ACK를 수신했을 경우에만 다음 프레임 송신
4. 만일 수신측으로 부터 NAK를 수신하거나 일정 시간까지 응답 프레임(ACK)를 수신 못하면 에러 발생으로 간주하고 해당 프레임 재전송

## 정지대기방식 장단점
* 장점
- 구현방법이 단순, 송신측내에 최대 프레임 크기의 버퍼를 1개 만 잡아도 됨

* 단점
- 송신측이 ACK을 수신할 때까지 다음 프레임을 전송할 수 없으므로 전송효율이 떨어진다.

 * 개선방안 => 슬라이딩 윈도우 방식 등

## 슬라이딩 윈도우 방식 = 연속적 ARQ(Continuous ARQ) = Go Back n ARQ
* 흐름제어를 위한 검출후 재전송 방식(ARQ)의 일종(혼잡제어도 가능)
* 일정한 윈도우 크기 이내에서 한번에 여러 패킷을 송신하고 이들 패킷에 대해 한 번의 ACK로 수신을 확인
* 윈도우 크기를 변경시키며 흐름제어(혼잡제어도 가능)하는 기법.
     
* 슬라이딩 윈도우 방식 주요 용도 
  - TCP, HDLC, 패킷교환(X.25) 등에 널리 이용

## 슬라이딩 윈도우 동작상 주요 요소
* 윈도우 구조   
=> 송신기, 수신기 모두에 유사한 윈도우 구조 유지 필요 있음   
=> 가장 중요한 변수는 버퍼의 여유 용량(윈도우 크기)임   
* 윈도우 크기(Window Size)   
=> 한번에 전송할 수 있는 최대 프레임 크기(통상 바이트 갯수)를 의미   
* 수신 윈도우 크기(rwnd,Receiving Window) : 수신 버퍼의 여유 용량   
=> 수신 윈도우 크기로 수신측에 의해 결정되어 송신측에 통보   
=> 아직 확인응답되지 않았으나 송신할 패킷 덩어리 크기   
* 혼잡 윈도우 크기(cwnd, Congestion Window) : 혼잡 미유발 한계 용량   
=> 네트워크 혼잡을 초래하지 않도록 송신율을 제한하는 (송신)윈도우 크기   
* 윈도우 크기 알림   
=> 수신측에서 송신측에게 얼마나 큰 윈도우 크기를 유지해야 하는지 알림    
* 윈도우 이동   
=> 윈도우 시작 위치(n)
 
# TCP 슬라이딩 윈도우 구현 요소
* TCP 헤더 내의 3개 필드 (순서번호, 승인번호, 윈도우 크기)로 구현됨.   
=> 송신측 TCP는 수백 바이트씩 모아 세그먼트 단위로 나누고, 윈도우 크기 내에서는 1이상의 세그먼트들을 연속 송신하고 한번의 확인 응답을 받게 됨   

![image](https://user-images.githubusercontent.com/68372094/163959347-8442cb5f-52f6-4051-88e3-2a4020b0e454.png)

* 주요 변수 관리
* 윈도우 시작 위체에 대한 변수 관리
=> 송신측 : '순서번호'로써 관리   
=> 수신측 :  승인번호(확인응답번호)로써 관리
 
* 윈도우 크기
=> 윈도우 크기는 흐름/혼잡제어를 수행하는 수단임.   
=> 윈도우 크기를 늘리거나 감소시켜 흐름/혼잡 제어 수행   

* 윈도우 크기 상한
=> TCP에서는 윈도우 크기를 TCP 최대 세그먼트 크기 (MSS) 보다 크게 할 수 없음   

* 실제 윈도우 크기
=> 실제 송신 윈도우 크기 = min(cwnd,rwnd)   
=> 즉, 둘 중 작은 값을 취함    

* 흐름제어 (수신측이 주도적으로 rwnd값 결정)
=> 수신측은 송신측에게 자신의 가능한 수신 버퍼 상태(rwnd)를 알리는 방법   
=> 수신측 ACK(확인응답)을 보내면서 현재 수신 윈도우 크기를 보냄   

* 혼잡제어 (네트워크 혼잡 상황에 따라 cwnd 값 결정)

 

