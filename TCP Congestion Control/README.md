# TCP Congestion Control

## TCP 혼잡 제어
* TCP의 혼잡 징후 판단   
=> TCP 타이머 (TimeOut)    
=> 중복 ACK   
=> RTT 세그먼트 지연   

* TCP 혼잡제어 원칙
=> TCP 관점 : TCP는 패킷 손실의 원인이 망의 혼잡에 기인한 것으로 봄   
=> TCP 행동 : 망 혼잡이 가중되지 않도록 각자 덜 이기적이도록 노력   

* TCP 혼잡제어 대응 방식
=> 혼잡 윈도우(cwnd)의 크기 조절   
=> 즉, 혼잡시 혼잡 윈도우의 크기(cwnd) 조정에 의해 전송률(송신률) 제어   

## TCP 혼잡제어 방식
* 제한된 형태의 혼잡제어 방식
=> RTT(왕복시간) 편차 고려 : 최근 계산된 RTT 값에 균형을 주도록 작은 RTT편차의 4배 취한 값을 더함   
=> 카른 알고리즘 : 재전송 세그먼트는 RTT 측정 대상에서 제외   
=> 지수 RTO(Retransmission TimeOut) 후퇴 : 재전송이 일어난 경우, 혼잡제어를 위해 RTO를 점차 두 배씩 늘려가능 방식   

* 송신측에서 연이은 재전송을 계속하여 혼잡 상황을 악화시키지 않도록 하는 방식
*    
* 포괄적 형태의 혼잡제어 방식   
=> 느린시작 : 지수 증가   
=> 연결 초기에 한꺼번에 보내지 않고 처음에는 작게 시작하나 점차 빠르게 송신 데이터량을 늘리는 방식   
=> 송신 데이터량을 늘리는 임계치 한계는 TCP MSS(Maximum Segment Size)   
* 혼잡 발생 상황을 예방하기 위해 세그먼트 송신율을 사전 억제하는 방식
 
### 혼잡 회피 : 가산 증가
=> 혼잡이 감지되면 지수적이 아닌 가산적인 증가 방식을 채택   

### 빠른 재전송
=> 정상적인 재전송 큐 과정을 따르지 않고 중간에 누락된 세그먼트를 빠르게 재전송   

### 빠른 회복
=> 이미 여러번 ACK가 오게되면, 비록 세그먼트들이 순서가 어긋나게 수신되더라도 네트워크 혼잡이라 여기지 않고 송신률을 빠르게 증가시킴


### TCP 재전송
=> 오류(패킷 손실, 지연, 중복, 순서역전 등)라고 믿어지는 상황 = 확인 응답되지 않은 데이터를 재전송한다.   
=> 한편 재전송, 흐름제어, 혼잡제어 셋 모두는 연관되므로 함께 고려되야 한다.   
=> 재전송이 흐름제어의 일부 기능이지만 많아질 경우 오히려 혼잡을 악화시킬 수 있다.   
=> 재전송에 따른 필요 사항(복사본 저장 및 재전송 타이머)   
=> 재전송 큐 : TCP 세그먼트가 전송될 때 마다 그 복사본이 재전송 큐에 저장된다.   
=> 재전송 타이머 : TCP 세그먼트 매 전송시 마다 재전송 타이머 가동   

### TCP 재전송에서 큐 관리 원칙
=> TCP는 세그먼트를 매번 송신할 시에 그에 따른 재전송 타이머의 가동과 동시에 재전송 큐에 보관한다.   
- 어떤 세그먼트가 타이머 만료 전에 확인 응답이 오면 큐에서 즉시 삭제   
- 어떤 세그먼트가 타이머 만료되면 자동 재전송   
- 재전송한 세그먼트도 확인 응답이 오기 전까지는 계속 큐에 머물게됨   
- 재전송 후에도 전송 실패가 계속 되면 TCP 연결 강제 종료   

### 큐 관리 효율성 제고 : 슬라이딩 윈도우
=> 바로 앞 세그먼트 전송에 대한 확인응답을 기다리지 않고, 수신측이 통보하는 윈도우 크기 내에서 묶어서 순서대로 연속 송신   

### TCP에서 재전송을 결정하는 기반 구분
=> 시간 기반 재전송 : TCP 타이머 기반   
- 확인응답을 기다리는 시간에 대한 재전송 타임아웃(RTO)   
- 적응적 재전송 알고리즘   
- 변화무쌍한 인터넷 환경에 따라 각 TCP 연결을 감시하며 적절한 타임아웃을 추정하고 변화에 따라 적응적으로 타임아웃 값을 수정함.   

### 빠른 재전송
=> 수신측으로부터의 재전송 요청에 기반을 두고 RTO를 기다리지 않는 빠른 재전송   
- 주로 빠른 재전송은 중복 ACK에 의해 유발   
- 중복 ACK(Duplicate Acknowlegment) :  하나의 원래 ACK와 중복된 ACK   
- 일련의 세그먼트들이 연이어 전송할 때, 중간 세그먼트가 손실되면 수신측의 확인 응답은 모두 같은 순서번호를 갖는 여러 중복된 ACK가 발생됨   

* 빠른 재전송   
=> 정상적인 재전송 큐 과정을 따르지 않고 중간 누락된 세그먼트를 빠르게 재전송   

* 빠른 회복
=> 이미 여러번 ACK가 오게되면 비록 세그먼트들이 순서가 어긋나게 수신되더라도 네트워크 혼잡이라 여기지 않고 송신률을 빠르게 증가시킴   


## RTT(Round Trip Time, 왕복 시간)
=> 패킷망(인터넷) 상에서 상대 호트트까지 패킷이 왕복하는데 걸리는 시간   
- 이에 영향을 주는 요소 : 망의 혼잡, 거리, 전송속도 등이 있음.   

=> IP 패킷의 RTT   
- IP 패킷 왕복 시간은 Ping 명령어를 사용하여 RTT(왕복시간) 및 TTL(Time to Live) 즉, IP 패킷 수명 수치를 알아볼 수 있다.   

=> TCP 세그먼트의 RTT 측정 및 RTO 예측/측정   
- RTT(Round Trip Time, 왕복 시간) 측정   
- 1 이상의 TCP 세그먼트를 보내면 1번만 확인 응답이 이루어지며 그 왕복시간을 측정   
- RTT 측정용 샘플 세그먼트의 송신부터 확인응답 받기까지의 왕복시간을 측정   
- 네트워크 가변성 때문에 RTT 샘플 측정값은 그때마다 달라지게 됨   

=> RTO(Retransmission TimeOut, 재전송 타임아웃 시간) 설정 또는 계산   
- 전송된 한 세그먼트에 대한 확인 응답을 기다려야 하는 시간
- TCP 재전송 타이머 값
- 송신 TCP는 매 세그먼트를 전송할 때마다 재전송 타이머(RTO) 가동함   
- RTO는 TCP 연결의 RTT(왕복시간) 보다 약간 크면 이상적임   
- 즉, 세그먼트 전송부터 확인응답 받기까지의 시간보다 약간 크면 좋다.   
- 얼마나 커야할지는 RTT 예측에 대한 여러 계산 방식들이 있다.


## Slow Start
=> 혼잡을 피하기 위한 TCP 알고리즘 중의 하나   
=> 연결설정 초기에 이미 혼잡한 환경이 있을 수 있기 때문에 혼잡 회피를 위해 초기에 조심스럽게 네트워크 데이터 송출량을 점증시켜가며 조사.   
=> TCP 발신자가 적절한 윈도우 크기를 신속하게 찾는데 도움을 준다.   

### Slow Start의 단점 : 연결 초기에 다소 지연 있음
### TCP 전송 윈도우 크기 조정
- TCP 발신자가 TCP 연결설정 후에, 전송 윈도우 크기를 점차 증가시킴   
- 윈도우 크기 관계식   
- awnd = minimum[rwnd,cwnd]   
- awnd = 전송 윈도우 크기 즉, 확인 응답없이 송신할 수 있는 세그먼트 수    
- rwnd = 수신 윈도우 크기 (수신측 버퍼 여유량)   
- cwnd = 혼잡 윈도우 크기 (연결초기 및 혼잡 상황ㅇ에서 사용되는 위도우)   
- 연결 초기에 cwnd = 1로 셋팅됨   
- 최대값이 될때까지 cwnd 1씩 증가시킴   
- 비록 윈도우 크기 cwnd는 1씩 증가하나 각각의 확인 응답되는 세그먼트마다 윈도우 크기가 1씩 증가하므로 실제 전송되는 세그먼트 수는 지수적으로 증가   
- 즉, 전송되는 세그먼트 수는 1,2,4,8,16 ... 배수로 지수적으로 증가



  
